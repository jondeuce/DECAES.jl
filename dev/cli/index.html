<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Command Line Interface · DECAES.jl</title><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.039/juliamono-regular.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.13.11/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="DECAES.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">DECAES.jl</a></span></div><form class="docs-search" action="../search/"><input class="docs-search-query" id="documenter-search-query" name="q" type="text" placeholder="Search docs"/></form><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li class="is-active"><a class="tocitem" href>Command Line Interface</a><ul class="internal"><li><a class="tocitem" href="#Using-the-CLI"><span>Using the CLI</span></a></li><li><a class="tocitem" href="#File-types"><span>File types</span></a></li><li><a class="tocitem" href="#Arguments"><span>Arguments</span></a></li><li><a class="tocitem" href="#Outputs"><span>Outputs</span></a></li><li><a class="tocitem" href="#Multithreading"><span>Multithreading</span></a></li><li><a class="tocitem" href="#Examples"><span>Examples</span></a></li><li><a class="tocitem" href="#Legacy-options"><span>Legacy options</span></a></li></ul></li><li><a class="tocitem" href="../ref/">API Reference</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>Command Line Interface</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Command Line Interface</a></li></ul></nav><div class="docs-right"><a class="docs-edit-link" href="https://github.com/jondeuce/DECAES.jl/blob/master/docs/src/cli.md" title="Edit on GitHub"><span class="docs-icon fab"></span><span class="docs-label is-hidden-touch">Edit on GitHub</span></a><a class="docs-settings-button fas fa-cog" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-sidebar-button fa fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a></div></header><article class="content" id="documenter-page"><h1 id="Command-Line-Interface"><a class="docs-heading-anchor" href="#Command-Line-Interface">Command Line Interface</a><a id="Command-Line-Interface-1"></a><a class="docs-heading-anchor-permalink" href="#Command-Line-Interface" title="Permalink"></a></h1><p>DECAES provides a command line interface (CLI) for calling the main analysis functions: <a href="../ref/#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a> for computing <span>$T_2$</span>-distributions, and <a href="../ref/#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a> for running <span>$T_2$</span>-parts analysis on the resulting <span>$T_2$</span>-distributions for computing measures such as the myelin water fraction.</p><h2 id="Using-the-CLI"><a class="docs-heading-anchor" href="#Using-the-CLI">Using the CLI</a><a id="Using-the-CLI-1"></a><a class="docs-heading-anchor-permalink" href="#Using-the-CLI" title="Permalink"></a></h2><p>Assuming you have <a href="../#installation">DECAES installed</a>, there are two equivalent ways to use the CLI:</p><p><strong>1. Helper script:</strong> Create a simple Julia script which calls the entrypoint function <a href="../ref/#DECAES.main"><code>main</code></a> provided by this package. For example, save the following code in a Julia script called <code>decaes.jl</code> (or, download the script located <a href="https://github.com/jondeuce/DECAES.jl/blob/master/api/decaes.jl">here</a>):</p><pre><code class="language-julia hljs">using DECAES # load the package
main() # call command line interface</code></pre><p>An image file <code>image.nii</code> can be passed to DECAES by running this script with <code>julia</code> from the command line:</p><pre><code class="language-bash hljs">$ julia decaes.jl -- image.nii &lt;COMMAND LINE ARGS&gt;</code></pre><p><strong>2. Julia <code>-e</code> flag:</strong> The contents of the above script can equivalently be passed directly to <code>julia</code> using the <code>-e</code> (for &quot;evaluate&quot;) flag:</p><pre><code class="language-bash hljs">$ julia -e &#39;using DECAES; main()&#39; -- image.nii &lt;COMMAND LINE ARGS&gt;</code></pre><p>Either way of calling the CLI forwards the arguments <code>&lt;COMMAND LINE ARGS&gt;</code> to the entrypoint function <a href="../ref/#DECAES.main"><code>main</code></a>. Available command line arguments are detailed in the <a href="#Arguments">Arguments</a> section.</p><p>For the remainder of this section, we will make use of the <code>decaes.jl</code> script from option 1.</p><h2 id="File-types"><a class="docs-heading-anchor" href="#File-types">File types</a><a id="File-types-1"></a><a class="docs-heading-anchor-permalink" href="#File-types" title="Permalink"></a></h2><p>Input files must be one of the following file types:</p><ol><li><a href="https://nifti.nimh.nih.gov/">NIfTI file</a> with extension <code>.nii</code>, or <a href="https://www.gzip.org/">gzip</a> compressed NIfTI file with extension <code>.nii.gz</code>. See <a href="https://github.com/JuliaIO/NIfTI.jl">NIfTI.jl</a> for more information.</li><li><a href="https://www.mathworks.com/help/matlab/import_export/mat-file-versions.html">MATLAB file</a> with extension <code>.mat</code>. <strong>Note:</strong> <code>.mat</code> files saved in the oldest format <code>v4</code> are not supported, but all newer formats (<code>v6</code>, <code>v7</code>, and <code>v7.3</code>) are supported. See <a href="https://github.com/JuliaIO/MAT.jl">MAT.jl</a> for more information.</li><li>Philips <a href="https://www.nitrc.org/plugins/mwiki/index.php/dcm2nii:MainPage#Philips_PAR.2FREC_Images">PAR/REC</a> file pair with extensions <code>.par</code> and <code>.rec</code> (or <code>.PAR</code> and <code>.REC</code>).</li><li>Philips XML/REC file pair with extensions <code>.xml</code> and <code>.rec</code> (or <code>.XML</code> and <code>.REC</code>).</li></ol><p>All output files are saved as <code>.mat</code> files in format <code>v7.3</code>. </p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If your data is in DICOM format, the <a href="https://www.nitrc.org/plugins/mwiki/index.php/dcm2nii:MainPage">freely available <code>dcm2niix</code> tool</a> is able to convert <a href="https://www.nitrc.org/plugins/mwiki/index.php/dcm2nii:MainPage#General_Usage">DICOM</a> files into NIfTI format</p></div></div><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><ul><li>Input files are interpreted as 4D arrays (or 3D arrays for mask files) when loaded; ensure that the underlying data is stored with the first three dimensions as (row, column, slice), and the last dimension as echo (or <span>$T_2$</span> bin, or omitted for mask files)</li><li>Images read from NIfTI and PAR/XML/REC files are coerced into the appropriate dimension; errors or unexpected behaviour may occur if the data is not stored with the correct dimensions</li><li>MATLAB files are searched for arrays with the appropriate dimension; the first such array that is found is used, otherwise an error will occur. <strong>Multiple 3D/4D arrays should not be stored in the same <code>.mat</code> file)</strong></li></ul></div></div><h2 id="Arguments"><a class="docs-heading-anchor" href="#Arguments">Arguments</a><a id="Arguments-1"></a><a class="docs-heading-anchor-permalink" href="#Arguments" title="Permalink"></a></h2><p>Available command line arguments are broken into four categories:</p><ol><li><strong>Positional arguments:</strong> these are the input files. Input files are typically placed at the beginning of <code>&lt;COMMAND LINE ARGS&gt;</code>.</li><li><strong>Optional arguments:</strong> settings governing the analysis pipeline. See below for details.</li><li><strong><a href="../ref/#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a>/<a href="../ref/#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a> arguments:</strong> settings for computing the <span>$T_2$</span>-distribution and subsequent <span>$T_2$</span>-parts analysis. Required arguments are listed first; see below for the full parameter list, and see <a href="../ref/#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a> and <a href="../ref/#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a> for parameter descriptions. Note: if no default is shown, the parameter is unused by default.</li><li><strong>B1 correction and stimulated echo correction:</strong> settings for controlling B1 correction and stimulated echo correction. These settings typically need not be modified. However, the following options are noteworthy: <code>--SetFlipAngle</code> for skipping B1 correction; and <code>--RefConAngle</code> for enabling stimulated echo correction.</li><li><strong>Additional save options:</strong> optional additional output maps</li><li><strong><a href="#bet">BET</a> arguments:</strong> settings for governing automatic brain mask generation using the BET brain extraction tool; <a href="#bet">see below</a> for details.</li></ol><pre class="documenter-example-output"><code class="nohighlight hljs ansi">usage: &lt;PROGRAM&gt; [-m MASK [MASK...]] [-o OUTPUT] [--T2map] [--T2part]
                 [-q] [--dry] [--legacy]
                 [--MatrixSize MATRIXSIZE MATRIXSIZE MATRIXSIZE]
                 [--nTE NTE] [--TE TE] [--nT2 NT2]
                 [--T2Range T2RANGE T2RANGE] [--SPWin SPWIN SPWIN]
                 [--MPWin MPWIN MPWIN] [--T1 T1] [--Reg REG]
                 [--Chi2Factor CHI2FACTOR] [--Sigmoid SIGMOID]
                 [--Threshold THRESHOLD] [--nRefAngles NREFANGLES]
                 [--nRefAnglesMin NREFANGLESMIN]
                 [--MinRefAngle MINREFANGLE]
                 [--SetFlipAngle SETFLIPANGLE]
                 [--RefConAngle REFCONANGLE] [--SaveDecayCurve]
                 [--SaveNNLSBasis] [--SaveRegParam]
                 [--SaveResidualNorm] [--bet] [--betargs BETARGS]
                 [--betpath BETPATH] input...

positional arguments:
  input                 one or more input filenames. Valid file types
                        are limited to: .mat, .nii, .nii.gz, .par,
                        .xml, and .rec

optional arguments:
  -m, --mask MASK [MASK...]
                        one or more mask filenames. Masks are loaded
                        and subsequently applied to the corresponding
                        input files via elementwise multiplication.
                        The number of mask files must equal the number
                        of input files. Valid file types are the same
                        as for input files, and are limited to: .mat,
                        .nii, .nii.gz, .par, .xml, and .rec
  -o, --output OUTPUT   output directory. If not specified, output
                        file(s) will be stored in the same location as
                        the corresponding input file(s). Outputs are
                        stored with the same basename as the input
                        files with additional suffixes; see --T2map
                        and --T2part
  --T2map               call T2mapSEcorr to compute T2 distributions
                        from 4D multi spin-echo input images. T2
                        distributions and T2 maps produced by
                        T2mapSEcorr are saved as MAT files with
                        extensions .t2dist.mat and .t2maps.mat
  --T2part              call T2partSEcorr to analyze 4D T2
                        distributions to produce parameter maps. If
                        --T2map is also passed, input 4D arrays are
                        interpreted as multi spin-echo images and T2
                        distributions are first computed by
                        T2mapSEcorr. If only --T2part is passed, input
                        4D arrays are interpreted as T2 distributions
                        and only T2partSEcorr is called. Output T2
                        parts are saved as a MAT file with extension
                        .t2parts.mat
  -q, --quiet           suppress printing to the terminal. Note: all
                        terminal outputs, including errors and
                        warnings, are still printed to the log file
  --dry                 execute dry run of processing without saving
                        any results
  --legacy              use legacy settings and algorithms from the
                        original MATLAB pipeline. This ensures that
                        the same T2-distributions and T2-parts will be
                        produced as those from MATLAB. Note that
                        execution time will be much slower, and less
                        robust algorithms will be used.

T2mapSEcorr/T2partSEcorr arguments:
  --MatrixSize MATRIXSIZE MATRIXSIZE MATRIXSIZE
                        first three dimensions of input 4D image.
                        Inferred automatically (type: Int64)
  --nTE NTE             number of echoes in input signal. Inferred
                        automatically when --T2map is passed (type:
                        Int64)
  --TE TE               inter-echo spacing (Units: seconds). Required
                        when --T2map is passed (type: Float64)
  --nT2 NT2             number of T2 components used in the
                        multi-exponential analysis. Required when
                        --T2map is passed. Inferred from fourth
                        dimension of input image if only --T2part is
                        passed (type: Int64)
  --T2Range T2RANGE T2RANGE
                        minimum and maximum T2 values (Units:
                        seconds). T2 components are logarithmically
                        spaced between these bounds. Required
                        parameter. (type: Float64)
  --SPWin SPWIN SPWIN   minimum and maximum T2 values of the short
                        peak window (Units: seconds). Required
                        parameter when --T2part is passed (type:
                        Float64)
  --MPWin MPWIN MPWIN   minimum and maximum T2 values of the middle
                        peak window (Units: seconds). Required
                        parameter when --T2part is passed (type:
                        Float64)
  --T1 T1               assumed value of longitudinal T1 relaxation
                        (Units: seconds). (type: Float64)
  --Reg REG             routine used for choosing regularization
                        parameter. One of &quot;none&quot;, &quot;chi2&quot;, &quot;gcv&quot;, or
                        &quot;lcurve&quot;, representing no regularization,
                        --Chi2Factor based Tikhonov regularization,
                        generalized cross-validation based
                        regularization, and L-curve based
                        regularization, respectively.
  --Chi2Factor CHI2FACTOR
                        if --Reg=&quot;chi2&quot;, the T2 distribution is
                        regularized such that the chi^2 goodness of
                        fit is increased by a multiplicative factor
                        --Chi2Factor relative to the unregularized
                        solution (type: Float64)
  --Sigmoid SIGMOID     replace the hard upper limit cutoff time of
                        the short peak window, --SPWin[2], with a
                        smoothed sigmoidal cutoff function, f, scaled
                        and shifted such that f(--SPWin[2] +/-
                        --Sigmoid) = 0.5 -/+ 0.4. --Sigmoid is the
                        time scale of the smoothing (Units: seconds)
                        (type: Float64)
  --Threshold THRESHOLD
                        first echo intensity cutoff for empty voxels.
                        Processing is skipped for voxels with
                        intensity &lt;= --Threshold (type: Float64)

B1 correction and stimulated echo correction:
  --nRefAngles NREFANGLES
                        in estimating the local refocusing flip angle
                        to correct for B1 inhomogeneities, up to
                        --nRefAngles angles in the range
                        [--MinRefAngle, 180] are explicitly checked.
                        The optimal angle is then determined through
                        interpolation from these --nRefAngles
                        observations. (type: Int64)
  --nRefAnglesMin NREFANGLESMIN
                        initial number of angles to check during flip
                        angle estimation before refinement near likely
                        optima. Setting --nRefAnglesMin equal to
                        --nRefAngles forces all angles to be checked.
                        (type: Int64)
  --MinRefAngle MINREFANGLE
                        minimum refocusing angle for flip angle
                        estimation (Units: degrees). (type: Float64)
  --SetFlipAngle SETFLIPANGLE
                        to skip B1 inhomogeneity correction, use
                        --SetFlipAngle to assume a fixed refocusing
                        flip angle for all voxels (Units: degrees).
                        (type: Float64)
  --RefConAngle REFCONANGLE
                        refocusing pulse control angle for stimulated
                        echo correction. Unlike B1 inhomogeneity
                        correction, stimulated echo correction must be
                        performed manually. By default, --RefConAngle
                        is set to 180 degrees, equivalent to no
                        stimulated echo correction (Units: degrees).
                        (type: Float64)

Additional save options:
  --SaveDecayCurve      include a 4D array of the time domain decay
                        curves resulting from the NNLS fits in the
                        output maps dictionary
  --SaveNNLSBasis       include a 5D (or 2D if --SetFlipAngle is used)
                        array of NNLS basis matrices in the output
                        maps dictionary. Note: this 5D array is
                        extremely large for typical image sizes; in
                        most cases, this flag should only be set when
                        debugging small datasets
  --SaveRegParam        include 3D arrays of the regularization
                        parameters and resulting chi^2-factors in the
                        output maps dictionary
  --SaveResidualNorm    include a 3D array of the l2-norms of the
                        residuals from the NNLS fits in the output
                        maps dictionary

BET arguments:
  --bet                 use the BET brain extraction tool from the FSL
                        library of analyis tools to automatically
                        create a binary brain mask. Only voxels within
                        the binary mask will be analyzed. Note that if
                        a mask is passed explicitly with the --mask
                        flag, this mask will be used and the --bet
                        flag will be ignored
  --betargs BETARGS     BET command line interface arguments. Must be
                        passed as a single string with arguments
                        separated by spaces, e.g. &#39;-m -n&#39;. The flag
                        &#39;-m&#39; indicates that a binary mask should be
                        computed, and therefore will be added to the
                        list of arguments if not provided (default:
                        &quot;-m -n -f 0.25 -R&quot;)
  --betpath BETPATH     path to BET executable. (default: &quot;bet&quot;)</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If desired, the <span>$T_2$</span>-distribution computation and the <span>$T_2$</span>-parts analysis may be performed separately:</p><ul><li>When the <code>--T2map</code> flag is passed, or both <code>--T2map</code> and <code>--T2part</code> flags are passed, input image arrays should be 4D with data as (row, column, slice, echo)</li><li>When only the <code>--T2part</code> flag is passed, input image arrays should be 4D with data as (row, column, slice, <span>$T_2$</span> bin)</li></ul></div></div><h2 id="Outputs"><a class="docs-heading-anchor" href="#Outputs">Outputs</a><a id="Outputs-1"></a><a class="docs-heading-anchor-permalink" href="#Outputs" title="Permalink"></a></h2><p>DECAES will produce up to five output files, each with the input filename (without suffix) used as a prefix. For example, if the input file is called <code>image.nii</code>, the possible output files are:</p><ol><li><code>image.t2dist.mat</code>: MATLAB file containing the 4D array of <span>$T_2$</span>-distributions (produced when <code>--T2map</code> flag is passed)</li><li><code>image.t2maps.mat</code>: MATLAB file containing <span>$T_2$</span>-distribution property maps and NNLS fit parameters; see <a href="../ref/#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a> (produced when <code>--T2map</code> flag is passed)</li><li><code>image.t2parts.mat</code>: MATLAB file containing <span>$T_2$</span>-parts analysis results such as the MWF; see <a href="../ref/#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a> (produced when <code>--T2part</code> flag is passed)</li><li><code>image.log</code>: Log file containing the console output</li><li><code>image.settings.txt</code>: Copy of settings file which was named <code>settings.txt</code> (produced when <a href="#settingsfiles">passing settings as a file</a>)</li></ol><p>If the <code>--dry</code> flag is passed, none of the above files will be produced.</p><h2 id="Multithreading"><a class="docs-heading-anchor" href="#Multithreading">Multithreading</a><a id="Multithreading-1"></a><a class="docs-heading-anchor-permalink" href="#Multithreading" title="Permalink"></a></h2><p>Multithreaded parallel processing can be enabled by setting the <code>julia</code> command line flag <code>--threads</code>, where <code>--threads N</code> enables parallel processing with <code>N</code> threads:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image.nii &lt;COMMAND LINE ARGS&gt;</code></pre><p>This is highly recommended to speed up computation time, but is not strictly required.</p><h2 id="Examples"><a class="docs-heading-anchor" href="#Examples">Examples</a><a id="Examples-1"></a><a class="docs-heading-anchor-permalink" href="#Examples" title="Permalink"></a></h2><h3 id="defaultoptions"><a class="docs-heading-anchor" href="#defaultoptions">Default options</a><a id="defaultoptions-1"></a><a class="docs-heading-anchor-permalink" href="#defaultoptions" title="Permalink"></a></h3><p>Suppose you have a multi spin-echo image file <code>image.nii</code> which you would like to perform <span>$T_2$</span> analysis on. We can call <a href="../ref/#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a> and <a href="../ref/#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a> on the file <code>image.nii</code> using <code>decaes.jl</code>. We pass the required arguments with the appropriate flags and leave the remaining parameters at default values:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image.nii --T2map --T2part --TE 10e-3 --nT2 40 --T2Range 10e-3 2.0 --SPWin 10e-3 40e-3 --MPWin 40e-3 200.0e-3 --Reg lcurve</code></pre><p>After a few seconds, the script should begin running with the following messages appearing as the script progresses (note that real images will take longer to process than this toy example):</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">
* Starting DECAES with 4 threads

* Loading input file: image.nii.gz ...

* Done (0.06 seconds)

* Running T2mapSEcorr on file: image.nii.gz ...
T2-distribution analysis settings:
    Chi2Factor       : nothing
    legacy           : false
    MatrixSize       : (100, 100, 1)
    MinRefAngle      : 50.0
    nRefAngles       : 32
    nRefAnglesMin    : 5
    nT2              : 40
    nTE              : 32
    RefConAngle      : 180.0
    Reg              : lcurve
    SaveDecayCurve   : false
    SaveNNLSBasis    : false
    SaveRegParam     : false
    SaveResidualNorm : false
    SetFlipAngle     : nothing
    Silent           : false
    T1               : 1.0
    T2Range          : (0.01, 2.0)
    TE               : 0.01
    Threshold        : 0.0

* Done (4.66 seconds)

* Saving T2 distribution to file: image.t2dist.mat ...

* Done (0.86 seconds)

* Saving T2 parameter maps to file: image.t2maps.mat ...

* Done (0.35 seconds)

* Running T2partSEcorr ...
T2-parts analysis settings:
    legacy     : false
    MatrixSize : (100, 100, 1)
    MPWin      : (0.04, 0.2)
    nT2        : 40
    Sigmoid    : nothing
    Silent     : false
    SPWin      : (0.01, 0.04)
    T2Range    : (0.01, 2.0)

* Done (0.05 seconds)

* Saving T2 parts maps to file: image.t2parts.mat ...

* Done (0.0 seconds)

* Finished (6.09 seconds)</code></pre><h3 id="settingsfiles"><a class="docs-heading-anchor" href="#settingsfiles">Settings files</a><a id="settingsfiles-1"></a><a class="docs-heading-anchor-permalink" href="#settingsfiles" title="Permalink"></a></h3><p>As there are several required parameters, it is convenient to store settings for DECAES in a settings file. Using the same options from the <a href="#defaultoptions">previous section</a>, we create a file <code>settings.txt</code> with the following contents:</p><pre><code class="nohighlight hljs">/path/to/image.nii
--T2map
--T2part
--TE
10e-3
--nT2
40
--T2Range
10e-3
2.0
--SPWin
10e-3
40e-3
--MPWin
40e-3
200.0e-3
--Reg
lcurve</code></pre><p>If this file is located at <code>/path/to/settings.txt</code>, simply prefix the filepath with the <code>@</code> character to have the file contents read into the <a href="../ref/#DECAES.main"><code>main</code></a> function:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- @/path/to/settings.txt</code></pre><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><ul><li>The use of settings files is highly recommended for both reproducibility and for self-documentation. The input settings file will be automatically copied into the output folder for each processed image, with the image filename prepended. In this case, for example, the copied settings file would be called <code>image.settings.txt</code></li><li>Only one flag or value is allowed per line within a settings file. Flags which require multiple inputs (e.g. <code>--T2Range</code> above) must use one line for each input</li><li>The extension of the settings file is ignored; <code>.txt</code> is arbitrary in this example</li><li>Though not strictly necessary, using full input- and output paths is recommended. This way, one doesn&#39;t rely on relative paths and can e.g. call <code>julia /path/to/decaes.jl @/path/to/settings.txt</code> from any directory</li></ul></div></div><h3 id="nondefault"><a class="docs-heading-anchor" href="#nondefault">Default settings files</a><a id="nondefault-1"></a><a class="docs-heading-anchor-permalink" href="#nondefault" title="Permalink"></a></h3><p>Suppose you have a default settings file <code>default.txt</code>, similar to the <code>settings.txt</code> file in the <a href="#settingsfiles">above section</a>. Settings in <code>default.txt</code> can be individually overridden. For example, if we are interested in changing the number of <span>$T_2$</span> bins <code>nT2</code> to 60, but leaving all other parameters the same, run the following:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- @/path/to/default.txt --nT2 60</code></pre><h3 id="multiinput"><a class="docs-heading-anchor" href="#multiinput">Multiple input files</a><a id="multiinput-1"></a><a class="docs-heading-anchor-permalink" href="#multiinput" title="Permalink"></a></h3><p>Multiple input files (possibly of different file types) can be passed in the obvious way:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image1.nii image2.mat image3.nii.gz image4.par &lt;COMMAND LINE ARGS&gt;</code></pre><p>Equivalently, place multiple image paths at the top of your settings file, with each path on a new line.</p><h3 id="outfolder"><a class="docs-heading-anchor" href="#outfolder">Specify output folder</a><a id="outfolder-1"></a><a class="docs-heading-anchor-permalink" href="#outfolder" title="Permalink"></a></h3><p>By default, output files are saved in the same location as the corresponding input file. If you&#39;d like to save them in a different folder, you can use the <code>-o</code> or <code>--output</code> flag:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image.nii --output /path/to/output/folder/ &lt;COMMAND LINE ARGS&gt;</code></pre><p>The requested output folder will be created if it does not already exist.</p><p>Equivalently, add <code>--output</code> and <code>/path/to/output/folder/</code> as consecutive lines in your settings file.</p><h3 id="passmasks"><a class="docs-heading-anchor" href="#passmasks">Passing image masks</a><a id="passmasks-1"></a><a class="docs-heading-anchor-permalink" href="#passmasks" title="Permalink"></a></h3><p>Image masks can be passed into DECAES using the <code>-m</code> or <code>--mask</code> flag:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image.nii --mask /path/to/mask.nii &lt;COMMAND LINE ARGS&gt;</code></pre><p>The mask file is loaded and applied to the input image via elementwise multiplication over the spatial dimensions, e.g. the mask is applied to each echo of a 4D multi-echo input image.</p><p>If multiple image files are passed, multiple corresponding mask files can be passed, too:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image1.nii image2.mat --mask /path/to/mask1.mat /path/to/mask2.nii.gz &lt;COMMAND LINE ARGS&gt;</code></pre><p>Equivalently, add <code>--mask</code>, <code>/path/to/mask1.mat</code>, <code>/path/to/mask2.mat</code>, ...  as consecutive lines in your settings file.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If input images have been manually masked such that they are zero outside regions of interest, a mask need not be passed. The <code>--Threshold</code> parameter of <a href="../ref/#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a> controls a first echo intensity cutoff threshold (default value 0.0), below which voxels are automatically skipped during processing</p></div></div><h3 id="bet"><a class="docs-heading-anchor" href="#bet">Automatic brain masking with BET</a><a id="bet-1"></a><a class="docs-heading-anchor-permalink" href="#bet" title="Permalink"></a></h3><p>The <a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/BET/UserGuide">BET brain extraction tool</a> from the <a href="https://fsl.fmrib.ox.ac.uk/fsl/fslwiki/FSL">FSL library of analysis tools</a> can be used to automatically generate a brain mask prior to analysis. Only voxels within the generated brain mask will be processed, greatly reducing analysis time. To use BET, pass the <code>--bet</code> flag:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image.nii --bet &lt;COMMAND LINE ARGS&gt;</code></pre><p>If <code>bet</code> is not on your system path, you can pass the path to the <code>bet</code> binary with the <code>--betpath</code> flag. Additionally, you can pass arguments to <code>bet</code> with the <code>--betargs</code> flag:</p><pre class="documenter-example-output"><code class="nohighlight hljs ansi">$ julia --threads 4 decaes.jl -- image.nii --bet --betpath /path/to/bet --betargs &#39;-m -n&#39; &lt;COMMAND LINE ARGS&gt;</code></pre><p>Note that <code>bet</code> arguments must be passed as a single string to <code>--betargs</code>, separated by spaces, as shown above.</p><p>Equivalently, add <code>--bet</code>, <code>--betpath</code>, <code>/path/to/bet</code>, <code>--betargs</code>, <code>-m -n ...</code> as consecutive lines in your settings file.</p><div class="admonition is-info"><header class="admonition-header">Note</header><div class="admonition-body"><p>If a mask file is passed using the <code>--mask</code> flag, the <code>--bet</code> flag will be ignored and the mask file will be used</p></div></div><h2 id="Legacy-options"><a class="docs-heading-anchor" href="#Legacy-options">Legacy options</a><a id="Legacy-options-1"></a><a class="docs-heading-anchor-permalink" href="#Legacy-options" title="Permalink"></a></h2><p>During the port from MATLAB to Julia, some algorithms were improved using computationally more efficient algorithms, and some default parameters were modified or removed as well. This may cause small differences in output parameter maps. As an example, the flip angle optimization procedure requires finding the root of a cubic spline. In MATLAB this was performed by evaluating the spline on a very fine mesh and choosing the value nearest zero. During profiling it was found that this was a time consuming operation, and therefore in Julia this was replaced by an efficient rootfinding method tailored for cubic splines.</p><p>The differences due to algorithmic changes like the one above are quite small. For example, most tests in the DECAES test suite will pass when using a relative tolerance of <span>$10^{-3}$</span>, and almost all tests pass with a relative tolerance of <span>$10^{-2}$</span>. That is to say that nearly all outputs are identical to 3 or more significant digits, which includes <span>$T_2$</span>-distributions, MWF maps, etc. It should be emphasized, though, that as these differences arise from improved algorithms, any discrepencies are merely small improvements.</p><p>The <code>--legacy</code> flag is available if <em>exact</em> reproducibility is required compared to the MATLAB version. This will ensure that all outputs match to nearly machine precision (a relative tolerance of <span>$10^{-10}$</span> is used during testing). Note however that the <code>--legacy</code> flag may cause a significant slowdown in processing time due to less efficient algorithms being used internally, and is therefore not recommended unless absolutely necessary. Differences due to changes in default parameters can always be overridden by passing in the desired value explicitly (e.g. <code>--SPWin 0.014 0.040</code>) without the need for the <code>--legacy</code> flag.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../">« Home</a><a class="docs-footer-nextpage" href="../ref/">API Reference »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 0.27.5 on <span class="colophon-date" title="Wednesday 28 July 2021 18:24">Wednesday 28 July 2021</span>. Using Julia version 1.6.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
