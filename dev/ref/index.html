<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>API Reference · DECAES.jl</title><meta name="title" content="API Reference · DECAES.jl"/><meta property="og:title" content="API Reference · DECAES.jl"/><meta property="twitter:title" content="API Reference · DECAES.jl"/><meta name="description" content="Documentation for DECAES.jl."/><meta property="og:description" content="Documentation for DECAES.jl."/><meta property="twitter:description" content="Documentation for DECAES.jl."/><script data-outdated-warner src="../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL=".."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../assets/documenter.js"></script><script src="../search_index.js"></script><script src="../siteinfo.js"></script><script src="../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../"><img src="../assets/logo.svg" alt="DECAES.jl logo"/></a><div class="docs-package-name"><span class="docs-autofit"><a href="../">DECAES.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../">Home</a></li><li><a class="tocitem" href="../cli/">Command Line Interface</a></li><li class="is-active"><a class="tocitem" href>API Reference</a><ul class="internal"><li><a class="tocitem" href="#t2map"><span><span>$T_2$</span>-distribution mapping</span></a></li><li><a class="tocitem" href="#t2part"><span><span>$T_2$</span>-parts and the myelin water fraction</span></a></li><li><a class="tocitem" href="#main"><span>Main entrypoint function</span></a></li><li><a class="tocitem" href="#nnls"><span>NNLS analysis</span></a></li><li><a class="tocitem" href="#epg"><span>Extended phase graph algorithm</span></a></li></ul></li><li><a class="tocitem" href="../internals/">Internals</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li class="is-active"><a href>API Reference</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>API Reference</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/jondeuce/DECAES.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/jondeuce/DECAES.jl/blob/master/docs/src/ref.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="API-Reference"><a class="docs-heading-anchor" href="#API-Reference">API Reference</a><a id="API-Reference-1"></a><a class="docs-heading-anchor-permalink" href="#API-Reference" title="Permalink"></a></h1><ul><li><a href="#DECAES.T2mapOptions"><code>DECAES.T2mapOptions</code></a></li><li><a href="#DECAES.T2partOptions"><code>DECAES.T2partOptions</code></a></li><li><a href="#DECAES.EPGdecaycurve"><code>DECAES.EPGdecaycurve</code></a></li><li><a href="#DECAES.T2mapSEcorr"><code>DECAES.T2mapSEcorr</code></a></li><li><a href="#DECAES.T2partSEcorr"><code>DECAES.T2partSEcorr</code></a></li><li><a href="#DECAES.lcurve_corner"><code>DECAES.lcurve_corner</code></a></li><li><a href="#DECAES.lsqnonneg"><code>DECAES.lsqnonneg</code></a></li><li><a href="#DECAES.lsqnonneg_chi2"><code>DECAES.lsqnonneg_chi2</code></a></li><li><a href="#DECAES.lsqnonneg_gcv"><code>DECAES.lsqnonneg_gcv</code></a></li><li><a href="#DECAES.lsqnonneg_lcurve"><code>DECAES.lsqnonneg_lcurve</code></a></li><li><a href="#DECAES.lsqnonneg_mdp"><code>DECAES.lsqnonneg_mdp</code></a></li><li><a href="#DECAES.lsqnonneg_tikh"><code>DECAES.lsqnonneg_tikh</code></a></li><li><a href="#DECAES.main"><code>DECAES.main</code></a></li></ul><h2 id="t2map"><a class="docs-heading-anchor" href="#t2map"><span>$T_2$</span>-distribution mapping</a><a id="t2map-1"></a><a class="docs-heading-anchor-permalink" href="#t2map" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.T2mapOptions" href="#DECAES.T2mapOptions"><code>DECAES.T2mapOptions</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">T2mapOptions(; kwargs...)
T2mapOptions(image::Array{T,4}; kwargs...) where {T}</code></pre><p>Options structure for <a href="#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a>. This struct collects keyword arguments passed to <code>T2mapSEcorr</code>, performs checks on parameter types and values, and assigns default values to unspecified parameters.</p><p><strong>Arguments</strong></p><ul><li><p><code>legacy::Bool</code>: Perform T2-mapping using legacy algorithms. Default: false</p></li><li><p><code>Threaded::Bool</code>: Perform T2-mapping using multiple threads. Default: Threads.nthreads() &gt; 1</p></li><li><p><code>MatrixSize::Tuple{Int64, Int64, Int64}</code>: Size of first 3 dimensions of input 4D image. This argument has no default, but is inferred automatically as <code>size(image)[1:3]</code> when calling <code>T2mapSEcorr(image; kwargs...)</code>.</p></li><li><p><code>nTE::Int64</code>: Number of echoes in input signal. This argument is has no default, but is inferred automatically as <code>size(image, 4)</code> when calling <code>T2mapSEcorr(image; kwargs...)</code>.</p></li><li><p><code>TE::Real</code>: Interecho spacing (Units: seconds). This argument has no default.</p></li><li><p><code>nT2::Int64</code>: Number of T2 times to estimate in the multi-exponential analysis. This argument has no default.</p></li><li><p><code>T2Range::Tuple{T, T} where T&lt;:Real</code>: Tuple of min and max T2 values (Units: seconds). This argument has no default.</p></li><li><p><code>T1::Real</code>: Assumed value of T1 (Units: seconds). Default: 1.0</p></li><li><p><code>Threshold::Real</code>: First echo intensity cutoff for empty voxels. Default: 0.0</p></li><li><p><code>MinRefAngle::Real</code>: Minimum refocusing angle for flip angle optimization (Units: degrees). Default: 50.0</p></li><li><p><code>nRefAngles::Int64</code>: During flip angle optimization, goodness of fit is checked for up to <code>nRefAngles</code> angles in the range <code>[MinRefAngle, 180]</code>. The optimal angle is then determined through interpolation from these samples. Default: if !legacy     64 else     8 end</p></li><li><p><code>nRefAnglesMin::Int64</code>: Initial number of angles to check during flip angle optimization before refinement near likely optima. Setting <code>nRefAnglesMin</code> equal to <code>nRefAngles</code> forces all angles to be checked. Default: if !legacy     min(5, nRefAngles) else     nRefAngles end</p></li><li><p><code>Reg::String</code>: Regularization routine to use. One of &quot;none&quot;, &quot;lcurve&quot;, &quot;gcv&quot;, &quot;chi2&quot;, or &quot;mdp&quot;, representing no regularization, the L-Curve method, the Generalized Cross-Validation method, <code>Chi2Factor</code>-based Tikhonov regularization, or the Morozov discrepancy principle, respectively.</p></li><li><p><code>Chi2Factor::Union{Nothing, T} where T&lt;:Real</code>: Constraint on <span>$\chi^2$</span> used for regularization when <code>Reg == &quot;chi2&quot;</code>. Default: nothing</p></li><li><p><code>NoiseLevel::Union{Nothing, T} where T&lt;:Real</code>: Estimate of the homoscedastic noise level <span>$|b_i - \hat{b}_i|$</span>, where <span>$b$</span> is the unknown true signal and <span>$\hat{b}$</span> is the measured corrupted signal. For Gaussian noise, this is the standard deviation. Default: nothing</p></li><li><p><code>RefConAngle::Real</code>: Refocusing pulse control angle (Units: degrees). Default: 180.0</p></li><li><p><code>SetFlipAngle::Union{Nothing, T} where T&lt;:Real</code>: Instead of optimizing flip angle, use <code>SetFlipAngle</code> for all voxels (Units: degrees). Default: nothing</p></li><li><p><code>SaveResidualNorm::Bool</code>: Boolean flag to include a 3D array of the <span>$\ell^2$</span>-norms of the residuals from the NNLS fits in the output maps dictionary. Default: false</p></li><li><p><code>SaveDecayCurve::Bool</code>: Boolean flag to include a 4D array of the time domain decay curves resulting from the NNLS fits in the output maps dictionary. Default: false</p></li><li><p><code>SaveRegParam::Bool</code>: Boolean flag to include 3D arrays of the regularization parameters <span>$\mu$</span> and resulting <span>$\chi^2$</span>-factors in the output maps dictionary. Default: false</p></li><li><p><code>SaveNNLSBasis::Bool</code>: Boolean flag to include a 5D (or 2D if <code>SetFlipAngle</code> is used) array of NNLS basis matrices in the output maps dictionary. Default: false</p></li><li><p><code>Silent::Bool</code>: Suppress printing to the console. Default: false</p></li></ul><div class="admonition is-info" id="Note-100c544f9f491d0b"><header class="admonition-header">Note<a class="admonition-anchor" href="#Note-100c544f9f491d0b" title="Permalink"></a></header><div class="admonition-body"><p>The 5D array that is saved when <code>SaveNNLSBasis</code> is set to <code>true</code> has dimensions <code>MatrixSize x nTE x nT2</code>, and therefore is typically extremely large. If the flip angle is fixed via <code>SetFlipAngle</code>, however, this is not an issue as only the unique <code>nTE x nT2</code> 2D basis matrix is saved.</p></div></div><p>See also:</p><ul><li><a href="#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/types.jl#L1-L18">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.T2mapSEcorr" href="#DECAES.T2mapSEcorr"><code>DECAES.T2mapSEcorr</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">T2mapSEcorr(image::Array{T,4}; &lt;keyword arguments&gt;)
T2mapSEcorr(image::Array{T,4}, opts::T2mapOptions{T})</code></pre><p>Uses nonnegative least squares (NNLS) to compute T2 distributions in the presence of stimulated echos by optimizing the refocusing pulse flip angle. Records parameter maps and T2 distributions for further partitioning.</p><p><strong>Arguments</strong></p><ul><li><code>image</code>: 4D array with intensity data as <code>(row, column, slice, echo)</code></li><li>A series of optional keyword argument settings which will be used to construct a <a href="#DECAES.T2mapOptions"><code>T2mapOptions</code></a> struct internally, or a <a href="#DECAES.T2mapOptions"><code>T2mapOptions</code></a> struct directly</li></ul><p><strong>Outputs</strong></p><ul><li><p><code>maps</code>: dictionary containing parameter maps with the following fields:</p><ul><li><p><strong>Default Fields</strong></p><ul><li><code>&quot;echotimes&quot;</code>     Echo times of time signal (length <code>nTE</code> 1D array)</li><li><code>&quot;t2times&quot;</code>       T2 times corresponding to T2-distributions (length <code>nT2</code> 1D array)</li><li><code>&quot;refangleset&quot;</code>   Refocusing angles used during flip angle optimization (length <code>nRefAngles</code> 1D array by default; scalar if <code>SetFlipAngle</code> is used)</li><li><code>&quot;decaybasisset&quot;</code> Decay basis sets corresponding to <code>&quot;refangleset&quot;</code> (<code>nTE x nT2 x nRefAngles</code> 3D array by default; <code>nTE x nT2</code> 2D array if <code>SetFlipAngle</code> is used)</li><li><code>&quot;gdn&quot;</code>:          Map of general density = sum(T2distribution) (<code>MatrixSize</code> 3D array)</li><li><code>&quot;ggm&quot;</code>:          Map of general geometric mean of T2-distribution (<code>MatrixSize</code> 3D array)</li><li><code>&quot;gva&quot;</code>:          Map of general variance (<code>MatrixSize</code> 3D array)</li><li><code>&quot;fnr&quot;</code>:          Map of fit to noise ratio = gdn / √(sum(residuals.^2) / (nTE-1)) (<code>MatrixSize</code> 3D array)</li><li><code>&quot;snr&quot;</code>:          Map of signal to noise ratio = maximum(signal) / std(residuals) (<code>MatrixSize</code> 3D array)</li><li><code>&quot;alpha&quot;</code>:        Map of optimized refocusing pulse flip angle (<code>MatrixSize</code> 3D array)</li></ul></li><li><p><strong>Optional Fields</strong></p><ul><li><code>&quot;resnorm&quot;</code>:      <span>$\ell^2$</span>-norm of NNLS fit residuals; see <code>SaveResidualNorm</code> option (<code>MatrixSize</code> 3D array)</li><li><code>&quot;decaycurve&quot;</code>:   Signal decay curve resulting from NNLS fit; see <code>SaveDecayCurve</code> option (<code>MatrixSize x nTE</code> 4D array)</li><li><code>&quot;mu&quot;</code>:           Regularization parameter used during from NNLS fit; see <code>SaveRegParam</code> option (<code>MatrixSize</code> 3D array)</li><li><code>&quot;chi2factor&quot;</code>:   <span>$\chi^2$</span> increase factor relative to unregularized NNLS fit; see <code>SaveRegParam</code> option (<code>MatrixSize</code> 3D array)</li><li><code>&quot;decaybasis&quot;</code>:   Decay bases resulting from flip angle optimization; see <code>SaveNNLSBasis</code> option (<code>MatrixSize x nTE x nT2</code> 5D array, or <code>nTE x nT2</code> 2D array if <code>SetFlipAngle</code> is used)</li></ul></li></ul></li><li><p><code>distributions</code>: T2-distribution array with data as <code>(row, column, slice, T2 amplitude)</code> (<code>MatrixSize x nT2</code> 4D array)</p></li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; image = DECAES.mock_image(; MatrixSize = (100, 100, 1), nTE = 48); # mock image with size 100x100x1x48

julia&gt; maps, dist = T2mapSEcorr(image; TE = 10e-3, nT2 = 40, T2Range = (10e-3, 2.0), Reg = &quot;lcurve&quot;, Silent = true); # compute the T2-maps and T2-distribution

julia&gt; maps
Dict{String, Any} with 10 entries:
  &quot;echotimes&quot;     =&gt; [0.01, 0.02, 0.03, 0.04, 0.05, 0.06, 0.07, 0.08,…
  &quot;t2times&quot;       =&gt; [0.01, 0.0114551, 0.013122, 0.0150315, 0.0172188…
  &quot;refangleset&quot;   =&gt; [50.0, 54.1935, 58.3871, 62.5806, 66.7742, 70.96…
  &quot;gdn&quot;           =&gt; [1.26381 1.27882 … 1.2463 1.25091; 1.29848 1.243…
  &quot;fnr&quot;           =&gt; [379.9 437.541 … 446.88 386.396; 485.27 360.591 …
  &quot;alpha&quot;         =&gt; [165.461 166.286 … 164.614 164.389; 163.735 164.…
  &quot;gva&quot;           =&gt; [0.691794 0.440231 … 0.0490302 0.1253; 0.849798 …
  &quot;ggm&quot;           =&gt; [0.0663333 0.0705959 … 0.056455 0.0576729; 0.053…
  &quot;snr&quot;           =&gt; [312.773 364.031 … 363.463 313.372; 372.631 313.…
  &quot;decaybasisset&quot; =&gt; [0.0277684 0.0315296 … 0.0750511 0.0751058; 0.04…</code></pre><p>See also:</p><ul><li><a href="#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a></li><li><a href="#DECAES.lsqnonneg"><code>lsqnonneg</code></a></li><li><a href="#DECAES.lsqnonneg_tikh"><code>lsqnonneg_tikh</code></a></li><li><a href="#DECAES.lsqnonneg_lcurve"><code>lsqnonneg_lcurve</code></a></li><li><a href="#DECAES.lsqnonneg_gcv"><code>lsqnonneg_gcv</code></a></li><li><a href="#DECAES.lsqnonneg_chi2"><code>lsqnonneg_chi2</code></a></li><li><a href="#DECAES.lsqnonneg_mdp"><code>lsqnonneg_mdp</code></a></li><li><a href="#DECAES.EPGdecaycurve"><code>EPGdecaycurve</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/T2mapSEcorr.jl#L77-L147">source</a></section></article><h2 id="t2part"><a class="docs-heading-anchor" href="#t2part"><span>$T_2$</span>-parts and the myelin water fraction</a><a id="t2part-1"></a><a class="docs-heading-anchor-permalink" href="#t2part" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.T2partOptions" href="#DECAES.T2partOptions"><code>DECAES.T2partOptions</code></a> — <span class="docstring-category">Type</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">T2partOptions(; kwargs...)
T2partOptions(t2dist::Array{T,4}; kwargs...) where {T}</code></pre><p>Options structure for <a href="#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a>. This struct collects keyword arguments passed to <code>T2partSEcorr</code>, performs checks on parameter types and values, and assigns default values to unspecified parameters.</p><p><strong>Arguments</strong></p><ul><li><p><code>legacy::Bool</code>: Calculate T2-parts using legacy algorithms. Default: false</p></li><li><p><code>Threaded::Bool</code>: Perform T2-parts using multiple threads. Default: Threads.nthreads() &gt; 1</p></li><li><p><code>MatrixSize::Tuple{Int64, Int64, Int64}</code>: Size of first 3 dimensions of input 4D T2 distribution. This argument is has no default, but is inferred automatically as <code>size(t2dist)[1:3]</code> when calling <code>T2partSEcorr(t2dist; kwargs...)</code>.</p></li><li><p><code>nT2::Int64</code>: Number of T2 times to use. This argument has no default.</p></li><li><p><code>T2Range::Tuple{T, T} where T&lt;:Real</code>: Tuple of min and max T2 values (Units: seconds). This argument has no default.</p></li><li><p><code>SPWin::Tuple{T, T} where T&lt;:Real</code>: Tuple of min and max T2 values of the short peak window (Units: seconds). This argument has no default.</p></li><li><p><code>MPWin::Tuple{T, T} where T&lt;:Real</code>: Tuple of min and max T2 values of the middle peak window (Units: seconds). This argument has no default.</p></li><li><p><code>Sigmoid::Union{Nothing, T} where T&lt;:Real</code>: Apply sigmoidal weighting to the upper limit of the short peak window in order to smooth the hard small peak window cutoff time. <code>Sigmoid</code> is the delta-T2 parameter, which is the distance in seconds on either side of the <code>SPWin</code> upper limit where the sigmoid curve reaches 10% and 90% (Units: seconds). Default: nothing</p></li><li><p><code>Silent::Bool</code>: Suppress printing to the console. Default: false</p></li></ul><p>See also:</p><ul><li><a href="#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/types.jl#L125-L138">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.T2partSEcorr" href="#DECAES.T2partSEcorr"><code>DECAES.T2partSEcorr</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">T2partSEcorr(T2distributions::Array{T,4}; &lt;keyword arguments&gt;)
T2partSEcorr(T2distributions::Array{T,4}, opts::T2partOptions{T})</code></pre><p>Analyzes T2 distributions produced by <a href="#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a> to produce data maps of a series of parameters.</p><p><strong>Arguments</strong></p><ul><li><code>T2distributions</code>: 4D array with data as <code>(row, column, slice, T2 amplitude)</code></li><li>A series of optional keyword argument settings which will be used to construct a <a href="#DECAES.T2partOptions"><code>T2partOptions</code></a> struct internally, or a <a href="#DECAES.T2partOptions"><code>T2partOptions</code></a> struct directly</li></ul><p><strong>Ouputs</strong></p><ul><li><p><code>maps</code>: a dictionary containing the following 3D data maps as fields:</p><ul><li><code>&quot;sfr&quot;</code>: small pool fraction, e.g. myelin water fraction (<code>MatrixSize</code> 3D array)</li><li><code>&quot;sgm&quot;</code>: small pool geometric mean T2 (<code>MatrixSize</code> 3D array)</li><li><code>&quot;mfr&quot;</code>: medium pool fraction, e.g. intra/extracellular water fraction (<code>MatrixSize</code> 3D array)</li><li><code>&quot;mgm&quot;</code>: medium pool geometric mean T2 (<code>MatrixSize</code> 3D array)</li></ul></li></ul><p><strong>Examples</strong></p><pre><code class="language-julia-repl hljs">julia&gt; dist = DECAES.mock_t2dist(; MatrixSize = (100, 100, 1), nT2 = 40); # mock distribution with size 100x100x1x40

julia&gt; maps = T2partSEcorr(dist; T2Range = (10e-3, 2.0), SPWin = (10e-3, 25e-3), MPWin = (25e-3, 200e-3), Silent = true); # compute T2-parts maps

julia&gt; maps
Dict{String, Any} with 4 entries:
  &quot;sgm&quot; =&gt; [0.014202 0.0106354 … 0.0125409 0.0114035; 0.0119888 0.0110439 …
  &quot;mfr&quot; =&gt; [0.86938 0.886926 … 0.901487 0.835647; 0.840086 0.890914 … 0.88…
  &quot;sfr&quot; =&gt; [0.13062 0.112288 … 0.0985133 0.163075; 0.159914 0.109086 … 0.1…
  &quot;mgm&quot; =&gt; [0.0871951 0.0481156 … 0.0612596 0.0475037; 0.0629991 0.0738904…</code></pre><p>See also:</p><ul><li><a href="#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/T2partSEcorr.jl#L1-L39">source</a></section></article><h2 id="main"><a class="docs-heading-anchor" href="#main">Main entrypoint function</a><a id="main-1"></a><a class="docs-heading-anchor-permalink" href="#main" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.main" href="#DECAES.main"><code>DECAES.main</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">main(command_line_args::Vector{String} = ARGS)</code></pre><p>Entry point function for command line interface, parsing the command line arguments <code>ARGS</code> and subsequently calling one or both of <code>T2mapSEcorr</code> and <code>T2partSEcorr</code> with the parsed settings. See the <a href="../cli/#Arguments">Arguments</a> section for available options.</p><p>See also:</p><ul><li><a href="#DECAES.T2mapSEcorr"><code>T2mapSEcorr</code></a></li><li><a href="#DECAES.T2partSEcorr"><code>T2partSEcorr</code></a></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/main.jl#L279-L289">source</a></section></article><h2 id="nnls"><a class="docs-heading-anchor" href="#nnls">NNLS analysis</a><a id="nnls-1"></a><a class="docs-heading-anchor-permalink" href="#nnls" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.lsqnonneg" href="#DECAES.lsqnonneg"><code>DECAES.lsqnonneg</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lsqnonneg(A::AbstractMatrix, b::AbstractVector)</code></pre><p>Compute the nonnegative least-squares (NNLS) solution <span>$X$</span> of the problem:</p><p class="math-container">\[X = \underset{x \ge 0}{\operatorname{argmin}}\; ||Ax - b||_2^2.\]</p><p><strong>Arguments</strong></p><ul><li><code>A::AbstractMatrix</code>: Left hand side matrix acting on <code>x</code></li><li><code>b::AbstractVector</code>: Right hand side vector</li></ul><p><strong>Outputs</strong></p><ul><li><code>X::AbstractVector</code>: NNLS solution</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/lsqnonneg.jl#L171-L188">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.lsqnonneg_tikh" href="#DECAES.lsqnonneg_tikh"><code>DECAES.lsqnonneg_tikh</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lsqnonneg_tikh(A::AbstractMatrix, b::AbstractVector, μ::Real)</code></pre><p>Compute the Tikhonov-regularized nonnegative least-squares (NNLS) solution <span>$X_{\mu}$</span> of the problem:</p><p class="math-container">\[X_{\mu} = \underset{x \ge 0}{\operatorname{argmin}}\; ||Ax - b||_2^2 + \mu^2 ||x||_2^2.\]</p><p><strong>Arguments</strong></p><ul><li><code>A::AbstractMatrix</code>: Left hand side matrix acting on <code>x</code></li><li><code>b::AbstractVector</code>: Right hand side vector</li><li><code>μ::Real</code>: Regularization parameter</li></ul><p><strong>Outputs</strong></p><ul><li><code>X::AbstractVector</code>: NNLS solution</li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/lsqnonneg.jl#L271-L289">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.lsqnonneg_lcurve" href="#DECAES.lsqnonneg_lcurve"><code>DECAES.lsqnonneg_lcurve</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lsqnonneg_lcurve(A::AbstractMatrix, b::AbstractVector)</code></pre><p>Compute the Tikhonov-regularized nonnegative least-squares (NNLS) solution <span>$X_{\mu}$</span> of the problem:</p><p class="math-container">\[X_{\mu} = \underset{x \ge 0}{\operatorname{argmin}}\; ||Ax - b||_2^2 + \mu^2 ||L x||_2^2\]</p><p>where <span>$L$</span> is the identity matrix, and <span>$\mu$</span> is chosen by locating the corner of the &quot;L-curve&quot;[1]. Details of L-curve theory can be found in Hansen (1992)[2].</p><p><strong>Arguments</strong></p><ul><li><code>A::AbstractMatrix</code>: Decay basis matrix</li><li><code>b::AbstractVector</code>: Decay curve data</li></ul><p><strong>Outputs</strong></p><ul><li><code>X::AbstractVector</code>: Regularized NNLS solution</li><li><code>mu::Real</code>: Resulting regularization parameter <span>$\mu$</span></li><li><code>chi2::Real</code>: Resulting increase in residual norm relative to the unregularized <span>$\mu = 0$</span> solution</li></ul><p><strong>References</strong></p><ol><li>A. Cultrera and L. Callegaro, &quot;A simple algorithm to find the L-curve corner in the regularization of ill-posed inverse problems&quot;. IOPSciNotes, vol. 1, no. 2, p. 025004, Aug. 2020, https://doi.org/10.1088/2633-1357/abad0d.</li><li>Hansen, P.C., 1992. Analysis of Discrete Ill-Posed Problems by Means of the L-Curve. SIAM Review, 34(4), 561-580, https://doi.org/10.1137/1034115.</li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/lsqnonneg.jl#L778-L805">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.lsqnonneg_gcv" href="#DECAES.lsqnonneg_gcv"><code>DECAES.lsqnonneg_gcv</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lsqnonneg_gcv(A::AbstractMatrix, b::AbstractVector)</code></pre><p>Compute the Tikhonov-regularized nonnegative least-squares (NNLS) solution <span>$X_{\mu}$</span> of the problem:</p><p class="math-container">\[X_{\mu} = \underset{x \ge 0}{\operatorname{argmin}}\; ||Ax - b||_2^2 + \mu^2 ||L x||_2^2\]</p><p>where <span>$L$</span> is the identity matrix, and <span>$\mu$</span> is chosen via the Generalized Cross-Validation (GCV) method:</p><p class="math-container">\[\mu = \underset{\nu \ge 0}{\operatorname{argmin}}\; \frac{||AX_{\nu} - b||_2^2}{\mathcal{T}(\nu)^2}\]</p><p>where <span>$\mathcal{T}(\mu)$</span> is the &quot;degrees of freedom&quot; of the regularized system</p><p class="math-container">\[\mathcal{T}(\mu) = \operatorname{tr}(I - A (A^T A + \mu^2 L^T L) A^T).\]</p><p>Details of the GCV method can be found in Hansen (1992)[1].</p><p><strong>Arguments</strong></p><ul><li><code>A::AbstractMatrix</code>: Decay basis matrix</li><li><code>b::AbstractVector</code>: Decay curve data</li></ul><p><strong>Outputs</strong></p><ul><li><code>X::AbstractVector</code>: Regularized NNLS solution</li><li><code>mu::Real</code>: Resulting regularization parameter <span>$\mu$</span></li><li><code>chi2::Real</code>: Resulting increase in residual norm relative to the unregularized <span>$\mu = 0$</span> solution</li></ul><p><strong>References</strong></p><ol><li>Hansen, P.C., 1992. Analysis of Discrete Ill-Posed Problems by Means of the L-Curve. SIAM Review, 34(4), 561-580, https://doi.org/10.1137/1034115.</li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/lsqnonneg.jl#L1092-L1129">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.lsqnonneg_chi2" href="#DECAES.lsqnonneg_chi2"><code>DECAES.lsqnonneg_chi2</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lsqnonneg_chi2(A::AbstractMatrix, b::AbstractVector, chi2_target::Real)</code></pre><p>Compute the Tikhonov-regularized nonnegative least-squares (NNLS) solution <span>$X_{\mu}$</span> of the problem:</p><p class="math-container">\[X_{\mu} = \underset{x \ge 0}{\operatorname{argmin}}\; ||Ax - b||_2^2 + \mu^2 ||x||_2^2\]</p><p>where <span>$\mu$</span> is determined by solving:</p><p class="math-container">\[\chi^2(\mu) = \frac{||AX_{\mu} - b||_2^2}{||AX_{0} - b||_2^2} = \chi^2_{\mathrm{target}}.\]</p><p>That is, <span>$\mu$</span> is chosen such that the squared residual norm of the regularized problem is <code>chi2_target</code> times larger than the squared residual norm of the unregularized problem.</p><p><strong>Arguments</strong></p><ul><li><code>A::AbstractMatrix</code>: Decay basis matrix</li><li><code>b::AbstractVector</code>: Decay curve data</li><li><code>chi2_target::Real</code>: Target <span>$\chi^2(\mu)$</span>; typically a small value, e.g. 1.02 representing a 2% increase</li></ul><p><strong>Outputs</strong></p><ul><li><code>X::AbstractVector</code>: Regularized NNLS solution</li><li><code>mu::Real</code>: Resulting regularization parameter <span>$\mu$</span></li><li><code>chi2::Real</code>: Resulting <span>$\chi^2(\mu)$</span>, which should be approximately equal to <code>chi2_target</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/lsqnonneg.jl#L468-L497">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.lsqnonneg_mdp" href="#DECAES.lsqnonneg_mdp"><code>DECAES.lsqnonneg_mdp</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lsqnonneg_mdp(A::AbstractMatrix, b::AbstractVector, δ::Real)</code></pre><p>Compute the Tikhonov-regularized nonnegative least-squares (NNLS) solution <span>$X_{\mu}$</span> of the problem:</p><p class="math-container">\[X_{\mu} = \underset{x \ge 0}{\operatorname{argmin}}\; ||Ax - b||_2^2 + \mu^2 ||x||_2^2\]</p><p>where <span>$\mu$</span> is chosen using Morozov&#39;s Discrepency Principle (MDP)[1,2]:</p><p class="math-container">\[\mu = \operatorname{sup}\; \left\{ \nu \ge 0 : ||AX_{\nu} - b|| \le \delta \right\}.\]</p><p>That is, <span>$\mu$</span> is maximized subject to the constraint that the residual norm of the regularized problem is at most <span>$\delta$</span>[1].</p><p><strong>Arguments</strong></p><ul><li><code>A::AbstractMatrix</code>: Decay basis matrix</li><li><code>b::AbstractVector</code>: Decay curve data</li><li><code>δ::Real</code>: Upper bound on regularized residual norm</li></ul><p><strong>Outputs</strong></p><ul><li><code>X::AbstractVector</code>: Regularized NNLS solution</li><li><code>mu::Real</code>: Resulting regularization parameter <span>$\mu$</span></li><li><code>chi2::Real</code>: Resulting increase in residual norm relative to the unregularized <span>$\mu = 0$</span> solution</li></ul><p><strong>References</strong></p><ol><li>Morozov VA. Methods for Solving Incorrectly Posed Problems. Springer Science &amp; Business Media, 2012.</li><li>Clason C, Kaltenbacher B, Resmerita E. Regularization of Ill-Posed Problems with Non-negative Solutions. In: Bauschke HH, Burachik RS, Luke DR (eds) Splitting Algorithms, Modern Operator Theory, and Applications. Cham: Springer International Publishing, pp. 113–135.</li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/lsqnonneg.jl#L660-L693">source</a></section></article><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.lcurve_corner" href="#DECAES.lcurve_corner"><code>DECAES.lcurve_corner</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">lcurve_corner(f, xlow, xhigh)</code></pre><p>Find the corner of the L-curve via curvature maximization using a modified version of Algorithm 1 from Cultrera and Callegaro (2020)[1].</p><p><strong>References</strong></p><ol><li>A. Cultrera and L. Callegaro, &quot;A simple algorithm to find the L-curve corner in the regularization of ill-posed inverse problems&quot;. IOPSciNotes, vol. 1, no. 2, p. 025004, Aug. 2020, https://doi.org/10.1088/2633-1357/abad0d.</li></ol></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/lsqnonneg.jl#L863-L871">source</a></section></article><h2 id="epg"><a class="docs-heading-anchor" href="#epg">Extended phase graph algorithm</a><a id="epg-1"></a><a class="docs-heading-anchor-permalink" href="#epg" title="Permalink"></a></h2><article class="docstring"><header><a class="docstring-article-toggle-button fa-solid fa-chevron-down" href="javascript:;" title="Collapse docstring"></a><a class="docstring-binding" id="DECAES.EPGdecaycurve" href="#DECAES.EPGdecaycurve"><code>DECAES.EPGdecaycurve</code></a> — <span class="docstring-category">Function</span><span class="is-flex-grow-1 docstring-article-toggle-button" title="Collapse docstring"></span></header><section><div><pre><code class="language-julia hljs">EPGdecaycurve(ETL::Int, α::Real, TE::Real, T2::Real, T1::Real, β::Real)</code></pre><p>Computes the normalized echo decay curve for a multi spin echo sequence using the extended phase graph algorithm using the given input parameters.</p><p>The sequence of flip angles used is slight generalization of the standard 90 degree excitation pulse followed by 180 degree pulse train. Here, the sequence used is <code>A*90, A*180, A*β, A*β, ...</code> where <code>A = α/180</code> accounts for B1 inhomogeneities. Equivalently, the pulse sequence can be written as <code>α/2, α, α * (β/180), α * (β/180), ...</code>. Note that if <code>α = β = 180</code>, we recover the standard <code>90, 180, 180, ...</code> pulse sequence.</p><p><strong>Arguments</strong></p><ul><li><code>ETL::Int</code>:   echo train length, i.e. number of echos</li><li><code>α::Real</code>:    angle of refocusing pulses (Units: degrees)</li><li><code>TE::Real</code>:   inter-echo time (Units: seconds)</li><li><code>T2::Real</code>:   transverse relaxation time (Units: seconds)</li><li><code>T1::Real</code>:   longitudinal relaxation time (Units: seconds)</li><li><code>β::Real</code>:    value of Refocusing Pulse Control Angle (Units: degrees)</li></ul><p><strong>Outputs</strong></p><ul><li><code>decay_curve::AbstractVector</code>: normalized echo decay curve with length <code>ETL</code></li></ul></div><a class="docs-sourcelink" target="_blank" href="https://github.com/jondeuce/DECAES.jl/blob/60c5fa460c3a63925b9e5f8cc1cfa8be4dbcd229/src/EPGdecaycurve.jl#L116-L142">source</a></section></article></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../cli/">« Command Line Interface</a><a class="docs-footer-nextpage" href="../internals/">Internals »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.15.0 on <span class="colophon-date" title="Friday 31 October 2025 01:39">Friday 31 October 2025</span>. Using Julia version 1.12.1.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
